package storage.ui;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;

/**
 * Creates a new 'replace saved final state with a new one and save dump to XML file' action.
 */
public abstract class SaveNewFinalStateAction extends AbstractAction {
    private final static ImageIcon SAVE_NEW_STATE_ICON = new ImageIcon(new byte[]{71, 73, 70, 56, 57, 97, 31, 0, 30, 0, (byte) 230, 0, 0, 51, 51, 51, (byte) 190, (byte) 148, 81, 0, (byte) 255, 0, 114, 100, (byte) 170, (byte) 209, (byte) 209, (byte) 232, 82, (byte) 130, 90, (byte) 198, (byte) 198, (byte) 215, (byte) 190, (byte) 188, (byte) 190, 38, (byte) 188, 38, 92, 75, (byte) 156, (byte) 255, (byte) 216, 122, 75, 60, (byte) 128, (byte) 133, 121, (byte) 189, 103, 43, 43, (byte) 217, (byte) 138, (byte) 137, (byte) 131, (byte) 131, (byte) 138, (byte) 255, (byte) 255, (byte) 255, (byte) 166, 125, 67, (byte) 149, (byte) 141, (byte) 195, 70, 58, 114, (byte) 204, (byte) 204, (byte) 204, 122, 99, 99, (byte) 209, (byte) 172, 70, 125, 114, (byte) 181, 72, 58, 88, (byte) 244, (byte) 211, 127, (byte) 153, 112, 63, (byte) 254, (byte) 219, (byte) 178, (byte) 151, (byte) 133, 116, (byte) 238, (byte) 238, (byte) 238, (byte) 255, (byte) 226, (byte) 193, (byte) 194, (byte) 154, 85, 121, 103, 86, 104, 90, (byte) 158, (byte) 161, (byte) 155, (byte) 203, (byte) 134, 127, 127, (byte) 221, (byte) 218, (byte) 220, 19, 93, 38, (byte) 202, (byte) 195, (byte) 176, (byte) 153, (byte) 153, (byte) 153, 94, 83, (byte) 141, 122, 122, (byte) 131, (byte) 203, 93, 92, 122, 106, (byte) 174, (byte) 176, (byte) 174, (byte) 171, (byte) 153, 125, 96, (byte) 253, (byte) 226, (byte) 149, 112, 94, (byte) 167, (byte) 170, 107, 107, (byte) 255, (byte) 239, (byte) 154, (byte) 225, (byte) 194, (byte) 129, (byte) 139, 127, (byte) 199, 95, 82, 97, (byte) 230, (byte) 230, (byte) 230, 91, 76, (byte) 145, (byte) 130, 117, (byte) 186, (byte) 190, (byte) 154, 118, (byte) 174, 95, 94, (byte) 153, (byte) 153, (byte) 204, (byte) 246, (byte) 247, (byte) 246, (byte) 247, (byte) 203, (byte) 159, 122, 108, (byte) 181, 68, 53, 91, (byte) 255, (byte) 232, (byte) 158, (byte) 255, (byte) 221, (byte) 133, (byte) 138, (byte) 161, (byte) 142, (byte) 212, (byte) 210, (byte) 213, (byte) 206, (byte) 172, 87, 88, 74, 99, (byte) 137, 126, (byte) 190, 108, 91, (byte) 165, (byte) 197, (byte) 197, (byte) 198, 81, 65, (byte) 140, (byte) 141, 52, 52, 84, 69, 92, (byte) 154, (byte) 148, (byte) 131, 115, 105, (byte) 167, (byte) 139, (byte) 130, 118, 100, 88, (byte) 146, (byte) 189, (byte) 148, 115, (byte) 174, (byte) 173, (byte) 199, (byte) 163, (byte) 163, (byte) 166, 100, (byte) 128, 99, 98, 82, (byte) 159, (byte) 249, (byte) 220, (byte) 141, (byte) 177, (byte) 136, 73, (byte) 174, (byte) 137, 98, 126, 116, 116, (byte) 132, 115, (byte) 181, (byte) 227, (byte) 224, (byte) 226, (byte) 213, (byte) 214, (byte) 214, (byte) 225, (byte) 225, (byte) 235, 79, 66, 126, (byte) 255, (byte) 238, (byte) 170, 64, 48, 69, (byte) 131, (byte) 139, (byte) 128, (byte) 150, (byte) 146, (byte) 142, (byte) 237, (byte) 233, (byte) 234, (byte) 154, (byte) 146, (byte) 198, (byte) 151, (byte) 135, (byte) 135, (byte) 213, (byte) 177, 64, 82, 65, 99, 102, 102, (byte) 153, (byte) 213, 103, 102, (byte) 180, (byte) 179, (byte) 179, (byte) 255, (byte) 235, (byte) 149, (byte) 140, (byte) 132, (byte) 186, (byte) 200, (byte) 167, 92, 102, (byte) 153, 102, (byte) 255, (byte) 230, (byte) 141, (byte) 164, (byte) 157, (byte) 155, 31, 94, 40, 102, 102, 102, (byte) 204, (byte) 159, 116, 110, 96, (byte) 166, (byte) 141, (byte) 141, (byte) 148, (byte) 222, (byte) 222, (byte) 222, (byte) 129, (byte) 129, (byte) 178, (byte) 216, (byte) 216, (byte) 219, 106, 95, (byte) 152, 85, 71, (byte) 134, (byte) 255, (byte) 244, (byte) 166, 91, 77, 105, (byte) 142, (byte) 131, (byte) 194, (byte) 153, (byte) 153, (byte) 204, (byte) 210, (byte) 173, 77, 78, 63, 86, (byte) 215, (byte) 207, (byte) 185, 33, (byte) 249, 4, 5, 20, 0, 2, 0, 44, 0, 0, 0, 0, 31, 0, 30, 0, 0, 7, (byte) 255, (byte) 128, 43, (byte) 130, 43, 7, (byte) 133, (byte) 134, (byte) 135, (byte) 136, (byte) 133, 47, (byte) 139, 47, 2, (byte) 142, (byte) 143, 43, 34, 123, 43, 16, (byte) 149, (byte) 150, (byte) 151, (byte) 152, (byte) 149, 47, 51, 51, 3, 53, (byte) 143, (byte) 142, (byte) 145, (byte) 147, (byte) 153, (byte) 153, 59, (byte) 166, 59, 16, 47, 23, 33, 3, 116, (byte) 160, 2, (byte) 162, (byte) 148, 20, (byte) 179, (byte) 180, (byte) 179, 71, (byte) 183, (byte) 183, (byte) 133, (byte) 169, 76, 33, 114, (byte) 174, (byte) 160, (byte) 177, (byte) 164, (byte) 151, (byte) 167, (byte) 166, (byte) 169, 117, 23, (byte) 190, (byte) 175, (byte) 193, 8, (byte) 204, (byte) 205, (byte) 206, (byte) 207, (byte) 169, 12, (byte) 200, (byte) 191, (byte) 144, (byte) 146, (byte) 148, (byte) 194, (byte) 196, (byte) 167, (byte) 209, (byte) 211, (byte) 202, (byte) 214, 16, (byte) 205, 0, 35, 20, 36, 118, (byte) 229, 118, 90, (byte) 232, 90, (byte) 209, 61, 70, (byte) 212, (byte) 161, (byte) 222, (byte) 150, 87, 56, 45, 44, (byte) 217, (byte) 218, 47, 55, (byte) 236, (byte) 238, (byte) 176, (byte) 222, 116, (byte) 254, 39, 86, 54, (byte) 196, 1, 113, 34, 93, (byte) 186, 84, (byte) 249, (byte) 218, 117, 27, 101, 73, 11, 24, 25, 30, 120, 88, 1, (byte) 211, 33, 27, (byte) 190, 30, 33, (byte) 246, (byte) 173, 16, 83, (byte) 228, 90, (byte) 165, 44, 20, 56, 108, (byte) 240, (byte) 224, 97, (byte) 200, (byte) 146, (byte) 138, (byte) 167, 84, (byte) 245, (byte) 152, (byte) 162, (byte) 145, (byte) 227, (byte) 138, 45, (byte) 150, 118, (byte) 208, 97, (byte) 129, 99, 3, 15, 23, 100, (byte) 150, (byte) 156, 34, (byte) 240, (byte) 162, (byte) 199, (byte) 202, (byte) 150, 69, 24, 48, 90, 20, 2, 69, 25, 13, 50, 20, 0, (byte) 177, (byte) 160, (byte) 196, 8, 35, (byte) 159, 44, (byte) 149, 113, 100, 64, (byte) 149, (byte) 234, (byte) 141, 27, 76, (byte) 238, (byte) 232, (byte) 209, (byte) 144, 65, 65, 27, 11, 68, 86, (byte) 248, (byte) 132, 10, (byte) 180, (byte) 170, (byte) 213, 27, 23, 46, (byte) 220, 81, 18, (byte) 161, 107, (byte) 155, 62, 68, (byte) 255, 122, (byte) 164, (byte) 189, 16, 21, (byte) 152, 24, (byte) 179, 3, (byte) 242, (byte) 234, 45, (byte) 234, 39, 2, 21, 32, 105, (byte) 224, (byte) 142, 77, (byte) 208, (byte) 178, (byte) 234, 0, 10, 66, (byte) 236, (byte) 208, (byte) 201, 82, (byte) 163, (byte) 134, (byte) 150, 35, 77, (byte) 170, 80, (byte) 161, 18, 88, 79, (byte) 143, 27, (byte) 132, (byte) 165, 26, 78, 124, (byte) 199, (byte) 137, (byte) 147, 48, 97, 106, 8, 57, 16, (byte) 153, (byte) 138, (byte) 139, 24, 67, (byte) 244, 92, (byte) 200, 12, 76, (byte) 130, (byte) 213, 1, 36, 72, (byte) 220, (byte) 185, (byte) 177, (byte) 162, 67, 104, 58, 20, 14, 120, (byte) 169, (byte) 226, (byte) 226, 116, 106, (byte) 214, (byte) 144, 36, 92, (byte) 189, 49, 32, 75, (byte) 150, (byte) 217, 43, 66, 103, (byte) 161, 35, (byte) 132, (byte) 194, 4, 12, 1, 92, (byte) 252, (byte) 200, 51, (byte) 196, (byte) 135, 29, 101, (byte) 194, (byte) 175, 122, 10, 115, (byte) 231, (byte) 194, (byte) 138, 26, 89, 72, (byte) 164, (byte) 227, (byte) 194, 5, (byte) 195, (byte) 135, 31, (byte) 211, (byte) 215, (byte) 128, (byte) 249, 4, 105, (byte) 197, (byte) 240, 1, (byte) 160, (byte) 187, (byte) 175, 8, (byte) 143, (byte) 142, (byte) 130, 22, 60, 54, (byte) 240, (byte) 208, 88, (byte) 211, (byte) 165, (byte) 139, 9, 41, 39, 116, (byte) 240, (byte) 136, 1, 117, (byte) 172, (byte) 144, (byte) 214, 0, 29, 116, 32, 31, 125, 90, 80, 96, (byte) 135, 13, 83, (byte) 228, 71, (byte) 196, 26, 127, (byte) 176, (byte) 241, (byte) 198, 23, 81, 8, (byte) 232, 8, 20, 70, 12, 96, (byte) 132, 13, 81, 68, 113, (byte) 194, (byte) 136, 115, (byte) 204, (byte) 241, 64, 10, 40, 38, (byte) 160, 34, 18, 11, 96, 80, 64, 9, 65, 80, (byte) 224, (byte) 134, 27, (byte) 160, (byte) 212, (byte) 224, (byte) 207, (byte) 141, 56, (byte) 230, (byte) 136, 99, 110, 112, 124, (byte) 129, (byte) 142, 3, 48, (byte) 160, (byte) 241, (byte) 202, (byte) 144, 68, 14, 121, (byte) 196, 21, 99, (byte) 228, (byte) 160, (byte) 194, 29, 25, 99, 20, (byte) 233, 36, (byte) 145, 53, 80, 112, 69, 3, 73, 84, 32, (byte) 196, (byte) 147, 88, (byte) 214, 72, (byte) 193, 8, 87, 92, (byte) 153, (byte) 229, (byte) 151, 68, 6, 2, 0, 59});
    private final static IFileChooser chooser = new ChooseFileDialog("ZI World XML dump|xml;gz", "Save dump with new final state to file ...", "Save", false);

    /**
     * Creates a new 'save new final state' action.
     */
    public SaveNewFinalStateAction() {
        super("Save with new final state", SAVE_NEW_STATE_ICON);
        putValue(SHORT_DESCRIPTION, "Save to XML file with new final state");
        putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S, KeyEvent.CTRL_MASK));
    }

    /**
     * Invoked when an action occurs.
     */
    public void actionPerformed(ActionEvent e) {
        String filename = chooser.choose();
        if (filename != null) {
            filename = filename.replace(".xml.gz", ".xml");
            if (!filename.endsWith(".xml")) {
                filename += ".xml";
            }
            processFile(filename);
        }
    }

    /**
     * Processes file whose name was specified by user in open file dialog.
     *
     * @param filename name of file to process.
     */
    public abstract void processFile(String filename);
}